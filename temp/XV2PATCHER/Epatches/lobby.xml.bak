<!-- 
	ON PAUSE: the total number of patches needed is estimated to be between 100 and 150, assuming there is no something else (a third object, or more static arrays in the two current objects) 
	At the very least, it is better to wait to see how stable this section of the game is, because maintaining these much patches if they break each update is not feasible 
	
	Some time later: after a look at 1.25.1: it is confirmed that this section of the game is unstable/on development. In fact, 37 of the current 42 patches here won't longer work in 1.25.1
	DIAGNOSTIC: this implementation is not worth it. 
	TODO: There may be another way of doing this without touching these fixed arrays / constants (maybe remapping things when a constant higher than MAX_LOBBY is detected in opcode "ACT AREAMOV" ?) 
	(1.24.1: 42EFAB, after call, eax gets the value of the constant) 
	Something like redirect the constant to ones of the existing, and then redirect any file load to the modded map. If there is a cache or files are preloaded, problems will happen.
	The case of cache could be fixed, the one of preloaded files would be much more troublesome.
-->

<?xml version="1.0" encoding="utf-8" ?>
<!--<EternityPatchFile name="Lobby" enabled="new_stages" comment="This file enables new lobbies stages">-->
<EternityPatchFile name="Lobby" enabled="false" comment="This file enables new lobbies stages">
	
	<!-- This will break on object size change (see next patch for info) -->
	<!-- This patch must always put before the next one, or otherwise the patched size destroys the signature -->
	<Patch name="PatchLobbyCResourceCtor" type="hook" search_start="0x3D8E06" comment="signature 1.24.1" >
		<Instruction code="B9 30 04 00 00" comment="mov ecx, 0x430" />
		<Instruction code="FF15 XXXXXXXX" comment="call operator new" />
		<Instruction code="48 89 44 24 40" comment="mov [rsp+40h], rax" />
		<Instruction code="48 85 C0" comment="test rax, rax" />
		<Instruction code="74 0D" coomment="jz short" />
		<Instruction code="48 8B C8" comment="mov rcx, rax" />
		<Instruction code="E8 XXXXXXXX" comment="call LobbyCResourceCtor" />
		<Instruction code="48 8B F8" comment="mov rdi, rax" />
		
		<Hook type="resolve_target" inst_index="6" value="LobbyCResourceCtor_Patched" setup="LobbyCResourceCtorSetup" />
	</Patch>
	
	<!-- The following patch is guaranteed to break if the CLobbyResource object is increased. 
	     Then it is a matter of finding the new object size. 
		 On new object size (currently 0x430), LobbyCResource in lobby_patch.cpp must be updated
         Reminder: this has 3 matches --> 	
	<Patch name="PatchLobbyCResourceAlloc" type="notify" search_start="0x3B0721" matches="3" comment="signature 1.24.1" >
		<Instruction code="41 83 C8 FF" comment="or r8d, -1" />
		<Instruction code="33 D2" comment="xor edx, edx" />
		<Instruction code="B9 30 04 00 00" comment="mov ecx, 0x430" />
		<Instruction code="FF15 XXXXXXXX" comment="call operator new" />
		
		<Notify inst_index="2" inst_offset="1" value="OnIncreaseLobbyResourceMemory" />
	</Patch>
	
	<Patch name="PatchLobbyMapList1" type="notify" search_start="0x416394" comment="signature 1.24.1" >
		<Instruction code="48 8D 3D XXXXXXXX" comment="lea rdi, lobby_maps_list" />
		<Instruction code="48 8D 99 20 01 00 00" comment="lea rbx, [rcx+120h]; maps2" />
		<Instruction code="48 83 3F 00" comment="cmp qword ptr [rdi], 0" />
		<Instruction code="74 48" comment="jz +48" />
		
		<Notify inst_index="0" inst_offset="3" value="PatchLobbyMapListRel" />
	</Patch>
	
	<Patch name="PatchLobbyMapList2" type="notify" search_start="0x4166C4" comment="signature 1.24.1" >
		<Instruction code="4D 63 C4" comment="movsxd r8, r12d" />
		<Instruction code="4F 8B 84 C5 XXXXXXXX" comment="mov r8, rva lobby_map_list[r13+r8*8]" />
		<Instruction code="48 8D 15 XXXXXXXX" comment="lea rdx, 'data/stage/%s.map'" />
		
		<Notify inst_index="1" inst_offset="4" value="PatchLobbyMapListAbs" />
	</Patch>
	
	<!-- In same function as above -->
	<Patch name="PatchLobbyMapList3" type="notify" search_start="0x4167E7" comment="signature 1.24.1" >
		<Instruction code="4E 8B 84 F0 XXXXXXXX" comment="mov r8, rva lobby_map_list[rax+r14*8]" />
		<Instruction code="48 8D 15 XXXXXXXX" comment="lea rdx, 'data/stage/%s.map'" />
		
		<Notify inst_index="0" inst_offset="4" value="PatchLobbyMapListAbs" />
	</Patch>
	
	<!-- Note: this signature has also a matching in other object. But the code in the DLL will protect against false positive by checking the buffer is indeed the lobby maps list. 
	     If message "I guess something weird happened" appears, adjust the search_start to correct.
		 Otherwise, the only solution to remove this problem fully is to make a HUUUGE signature
     -->	
	<Patch name="PatchLobbyMapList4" type="notify" search_start="0x4176CF" comment="signature 1.24.1" >
		<Instruction code="8B C2" comment="mov eax, edx" />
		<Instruction code="48 8D 15 XXXXXXXX" comment="lea rdx, lobby_maps_list" />
		<Instruction code="48 8B 14 C2" comment="mov rdx, [rdx+rax*8]" />
		
		<Notify inst_index="1" inst_offset="3" value="PatchLobbyMapListRel" />
	</Patch>
	
	<Patch name="PatchLobbyInteger" type="notify" search_start="0x414B80" comment="signature 1.24.1" >
		<Instruction code="8D 42 FF" comment="lea eax, [rdx-1]" />
		<Instruction code="83 F8 0E" comment="cmp eax, 0Eh" />
		<Instruction code="77 11" comment="ja 11" />
		<Instruction code="8D 42 FF" comment="lea eax, [rdx-1]; shitty optimizer that didn't catch same instruction" />
		<Instruction code="48 63 C8" comment="movsxd rcx, eax" />
		<Instruction code="48 8D 05 XXXXXXXX" comment="lea rax, lobby_integer" />
		
		<Notify inst_index="5" inst_offset="3" value="PatchLobbyIntegerRel" />		
	</Patch>
	
	<Patch name="PatchLobbySpm" type="notify" search_start="0x416910" comment="signature 1.24.1" >
		<Instruction code="4C 8B 8C 07 XXXXXXXX" comment="mov r9, [rdi+rax+lower spm_list]" />
		<Instruction code="4D 85 C9" comment="test r9, r9" />
		<Instruction code="74 40" comment="jz +40" />
		<Instruction code="4C 8B 84 07 XXXXXXXX" comment="mov r8, [rdi+rax+lower spm_ldir_ist]" />
		
		<Notify inst_index="0" inst_offset="4" value="PatchLobbySpmAbs" />
	</Patch>
	
	<!-- Same signature as above -->
	<Patch name="PatchLobbySpmDir" type="notify" search_start="0x416910" comment="signature 1.24.1" >
		<Instruction code="4C 8B 8C 07 XXXXXXXX" comment="mov r9, [rdi+rax+lower spm_list]" />
		<Instruction code="4D 85 C9" comment="test r9, r9" />
		<Instruction code="74 40" comment="jz +40" />
		<Instruction code="4C 8B 84 07 XXXXXXXX" comment="mov r8, [rdi+rax+lower spm_ldir_ist]" />
		
		<Notify inst_index="3" inst_offset="4" value="PatchLobbySpmDirAbs" />
	</Patch>
	
	<!-- Because it seems id is always idx+1, we'll get rid of the fixed-size array and just convert using that logic with a simple write patch 
	     And there it goes one fixed array that we don't need to extend -->
	<Patch name="PatchLobbyIdxToId" type="write" search_start="0x416780" comment="signature 1.24.1." >
		<Instruction code="42 8B 94 B0 XXXXXXXX" comment="mov edx, lobby_idx_to_id[rax+r14*4]" />
		<Instruction code="49 8B CC" comment="mov rcx, r12" />
		<Instruction code="E8 XXXXXXXX" comment="call XXXXXXXX" />
		
		<!-- mov edx, r14d; inc edx; fill-nop -->
		<Write value="4489F2 FFC2 909090" />    		
	</Patch>
	
	<!--Note: the remaining part of this code will be nopped. Don't add more instructions to the signature -->
	<!-- Also the return address of the patch shall be considered the instruction after the last instruction of the patch -->
	<!-- This patch is sensitive, any change may require changes in the DLL -->
	<Patch name="PatchLobbyM1A1" type="notify" search_start="0x416766" comment="signature 1.24.1" >
		<Instruction code="49 8D 76 03" comment="lea rsi, [r14+3]" />
		<Instruction code="48 03 F6" comment="add rsi, rsi" />
		<Instruction code="49 83 7C F5 00 00" comment="cmp qword ptr [r13+rsi*8+0], 0" />
		
		<Notify value="PatchLobbyM1A1" />
	</Patch>
	
	<!-- Same notes of above patch apply here -->
	<Patch name="PatchLobbyM1A3" type="notify" search_start="0x41679A" comment="signature 1.24.1" >
		<Instruction code="49 8D 46 01" comment="lea rax, [r14+1]" />
		<Instruction code="48 03 C0" comment="add rax, rax" />
		<Instruction code="41 C7 44 C5 28 01 00 00 00" comment="mov dword ptr [r13+rax*8+28h], 1" />
		
		<Notify value="PatchLobbyM1A3" />
	</Patch>
	
	<!-- Only inst_index=4 and inst_index=5 will be deleted. The other instructions will be kept -->
	<!-- Sensitive patch, any change may require change the code in the DLL -->
	<!-- Signature is big because there was other fragment of code that resembled this in the game -->
	<Patch name="PatchLobbyM1A4" type="notify" search_start="0x414D96" comment="signature 1.24.1" >
		<Instruction code="48 8D 59 20" comment="lea rbx, [rcx+20h]" />
		<Instruction code="8B F7" comment="mov esi, edi" />
		<Instruction code="48 8B E9" comment="mov rbp, rcx" />
		<Instruction code="90" comment="nop" />
		<Instruction code="48 8B 0B" comment="mov rcx, [rbx]" />
		<Instruction code="48 85 C9" comment="test rcx, rcx" />
		<Instruction code="74 0E" comment="jz +E" />
		<Instruction code="48 8B 01" comment="mov rax, [rcx]" />
		<Instruction code="FF 50 50" comment="call qword ptr [rax+50h]" />
		<Instruction code="85 C0" comment="test eax, eax" />
		<Instruction code="0F 84 XX XX 00 00" comment="jz return_0" />
		<Instruction code="FF C6" comment="inc esi" />
		<Instruction code="48 83 C3 10" comment="add rbx, 10h" />
		<Instruction code="83 FE 10" comment="cmp esi, 10h" />
		
		<Notify inst_index="4" value="PatchLobbyM1A4" />
	</Patch>
	
	<!-- This simple function will be reimplemented by the patcher. Pay attention to any change to see if the reimplementation remains valid -->
	<Patch name="ReimplementLobbyM1A5" type="hook" search_start="0x414B60" comment="signature 1.24.1" >
		<Instruction code="83 FA FF" comment="cmp edx, -1" />
		<Instruction code="7D 03" comment="jge +3" />
		<Instruction code="33 C0 C3" comment="xor eax, eax; retn" />
		<Instruction code="83 FA 10" comment="cmp edx, 10h" />
		<Instruction code="7F F8" comment="jg return null" />
		<Instruction code="48 63 C2" comment="movsxd rax, edx" />
		
		<Hook value="ReimplementLobbyM1A5" />	
	</Patch>
	
	<!-- Only the first two instructions will be deleted. The other instructions will be kept -->
	<!-- Sensitive patch, any change may require change the code in the DLL -->
	<Patch name="PatchLobbyM1A6" type="notify" search_start="0x416CEE" comment="signature 1.24.1" >
		<Instruction code="BF 01 00 00 00" comment="mov edi, 1" />
		<Instruction code="48 8D 5E 30" comment="lea rbx, [rsi+30]" />
		<Instruction code="44 39 73 08" comment="cmp [rbx+8], r14d" />
		<Instruction code="75 15" comment="jne + 15" />		
		
		<Notify value="PatchLobbyM1A6" />
	</Patch>
	
	<!-- Only inst_index=1 and inst_index=2 will be deleted. The other instructions will be kept -->
	<!-- Sensitive patch, any change may require change the code in the DLL -->
	<Patch name="PatchLobbyM1A9" type="notify" search_start="0x416B4B" comment="signature 1.24.1" >
		<Instruction code="48 89 2B" comment="mov [rbx], rbp" />
		<Instruction code="FF C7" comment="inc edi" />
		<Instruction code="48 83 C3 10" comment="add rbx, 10h" />
		<Instruction code="83 FF 10" comment="cmp edi, 10h" />
		<Instruction code="72 DA" comment="jb loop" />		
		
		<Notify inst_index="1" value="PatchLobbyM1A9" />
	</Patch>
	
	<!-- The patch must include the whole loop so that the return address of the patch is known (the whole loop needs to be replaced because of the particularities of this one in concrete) -->
	<Patch name="PatchLobbyM1A10" type="notify" search_start="0x416C8C" comment="signature 1.24.1" >
		<Instruction code="48 8D 4E 20" comment="lea rcx, [rsi+20h]" />
		<Instruction code="B8 04 00 00 00" comment="mov eax, 4" />
		
		<Instruction code="4C 39 01" comment="cmp [rcx], r8" />
		<Instruction code="75 07" comment="jne +7" />
		<Instruction code="44 89 71 08" cmment="mov [rcx+8], r14d" />
		<Instruction code="4C 89 31" comment="mov [rcx], r14" />
		
		<Instruction code="4C 39 41 10" comment="cmp [rcx+10h], r8" />
		<Instruction code="75 08" comment="jne +8" />
		<Instruction code="44 89 71 18" cmment="mov [rcx+18h], r14d" />
		<Instruction code="4C 89 71 10" comment="mov [rcx+10], r14" />
		
		<Instruction code="4C 39 41 20" comment="cmp [rcx+20h], r8" />
		<Instruction code="75 08" comment="jne +8" />
		<Instruction code="44 89 71 28" cmment="mov [rcx+28h], r14d" />
		<Instruction code="4C 89 71 20" comment="mov [rcx+20], r14" />
		
		<Instruction code="4C 39 41 30" comment="cmp [rcx+30h], r8" />
		<Instruction code="75 08" comment="jne +8" />
		<Instruction code="44 89 71 38" cmment="mov [rcx+38h], r14d" />
		<Instruction code="4C 89 71 30" comment="mov [rcx+30], r14" />
		
		<Instruction code="48 83 C1 40" comment="add rcx, 40h" />
		<Instruction code="48 83 E8 01" comment="sub rax, 1" />
		<Instruction code="75 C0" comment="jnz loop" />
		
		<Notify value="PatchLobbyM1A10" />
	</Patch>
	
	<!-- If this patch fails, there is the possibility that maps2 has been relocated in the object -->
	<!-- This is in the same function that PatchLobbyMapList1 -->
	<Patch name="PatchLobbyM2A1" type="notify" search_start="0x41639B" comment="signature 1.24.1" >
		<Instruction code="48 8D 99 20 01 00 00" comment="lea rbx, [rcx+120h]; maps2" />
		<Instruction code="48 83 3F 00" comment="cmp qword ptr [rdi], 0" />
		<Instruction code="74 48" comment="jz +48" />
		
		<Notify inst_index="0" inst_offset="3" value="PatchLobbyM2Multi" />
	</Patch>
	
	<!-- Pretty much same concept as above, with same warnings -->
	<Patch name="PatchLobbyM2A3" type="notify" search_start="0x414DFD" comment="signature 1.24.1" >
		<Instruction code="48 8D 9D 20 01 00 00" comment="lea rbx, [rbp+120h]; maps2" />
		<Instruction code="48 8B 0B" comment="mov rcx, rbx" />
		<Instruction code="48 85 C9" comment="test rcx, rcx" />
		
		<Notify inst_index="0" inst_offset="3" value="PatchLobbyM2Multi" />
	</Patch>
	
	<!-- Pretty much same concept as above, with same warnings -->
	<Patch name="PatchLobbyM2A5" type="notify" search_start="0x416B88" comment="signature 1.24.1" >
		<Instruction code="48 8D 9E 20 01 00 00" comment="lea rbx, [rsi+120h]; maps2" />
		<Instruction code="90" comment="nop" />
		<Instruction code="83 7B 08 00" comment="cmp dword ptr [rbx+8], 0" />
		
		<Notify inst_index="0" inst_offset="3" value="PatchLobbyM2Multi" />
	</Patch>
	
	<!-- Pretty much same concept as above, with same warnings -->
	<Patch name="PatchLobbyM2A6" type="notify" search_start="0x416D60" comment="signature 1.24.1" >
		<Instruction code="48 8D 9E 20 01 00 00" comment="lea rbx, [rsi+120h]; maps2" />
		<Instruction code="44 39 73 08" comment="cmp [rbx+8], r14d" />
		
		<Notify inst_index="0" inst_offset="3" value="PatchLobbyM2Multi" />
	</Patch>
	
	<!-- This simple function will be reimplemented by the patcher. Pay attention to any change to see if the reimplementation remains valid -->
	<Patch name="ReimplementLobbyM2A4" type="hook" search_start="0x414AE0" comment="signature 1.24.1" >
		<Instruction code="83 FA FF" comment="cmp edx, -1" />
		<Instruction code="7D 03" comment="jge +3" />
		<Instruction code="33 C0 C3" comment="xor eax, eax; retn" />
		<Instruction code="83 FA 10" comment="cmp edx, 10h" />
		<Instruction code="7F F8" comment="jg return null" />
		<Instruction code="8D 42 FF" comment="lea eax, [rdx-1]" />
		
		<Hook value="ReimplementLobbyM2A4" />	
	</Patch>		
	
	<!-- This will break on object size change (see next patch for info) -->
	<!-- This patch must always put before the next one, or otherwise the patched size destroys the signature -->
	<Patch name="PatchLobbyMapCtor" type="hook" search_start="0x2F0BD7" comment="signature 1.24.1" >
		<Instruction code="B9 68 04 00 00" comment="mov ecx, 0x468" />
		<Instruction code="FF15 XXXXXXXX" comment="call operator new" />
		<Instruction code="48 89 44 24 40" comment="mov [rsp+40h], rax" />
		<Instruction code="48 85 C0" comment="test rax, rax" />
		<Instruction code="74 12" coomment="jz short" />
		<Instruction code="48 8B C8" comment="mov rcx, rax" />
		<Instruction code="E8 XXXXXXXX" comment="call LobbyMapCtor" />
		
		<Hook type="resolve_target" inst_index="6" value="LobbyMapCtor_Patched" setup="LobbyMapCtorSetup" />
	</Patch>
	
	<!-- The following patch is guaranteed to break if the CLobbyResource object is increased. 
	     Then it is a matter of finding the new object size. 
		 On new object size (currently 0x468), LobbyMap in lobby_patch.cpp must be updated
         Reminder: this has 4 matches --> 	
	<Patch name="PatchLobbyMapAlloc" type="notify" search_start="0x2F0BD1" matches="4" comment="signature 1.24.1" >
		<Instruction code="41 83 C8 FF" comment="or r8d, -1" />
		<Instruction code="33 D2" comment="xor edx, edx" />
		<Instruction code="B9 68 04 00 00" comment="mov ecx, 0x468" />
		<Instruction code="FF15 XXXXXXXX" comment="call operator new" />
		
		<Notify inst_index="2" inst_offset="1" value="OnIncreaseLobbyMapMemory" />
	</Patch>
	
	<!-- Reimplemented function. On changes, check mainly check if the number "5" has changed. -->
	<Patch name="PatchLobbyReimplementEFlag" type="hook" search_start="0x3F4EC0" comment="signature 1.24.1" >
		<Instruction code="33 C0" comment="xor eax, eax" />
		<Instruction code="8D 4A FF" comment="lea ecx, [rdx-1]" />
		<Instruction code="83 F9 05" comment="cmp ecx, 5" />
		
		<Hook value="ReimplementLobbyEFlag" />
	</Patch>
	
	<!-- Only the first instruction will be deleted. The other instructions will be kept -->
	<!-- Sensitive patch, any change may require change the code in the DLL -->
	<Patch name="PatchLobbyA1RW1" type="notify" search_start="0x3F320B" comment="signature 1.24.1" >
		<Instruction code="48 8D 99 A0 00 00 00" comment="lea rbp, rbx, [rcx+0A0h]" />
		<Instruction code="8D 6E FF" comment="lea ebp, [rsi-1]" />
		<Instruction code="45 33 F6" comment="xor r14d, r14d" />
		
		<Notify value="PatchLobbyA1RW1_A1R2A1R3" />
	</Patch>	
	
	<!-- Same as above. -->
	<Patch name="PatchLobby_A1R2A1R3" type="notify" search_start="0x3F6BD6" comment="signature 1.24.1" >
		<Instruction code="48 83 EC 20" comment="sub rsp, 20h" />
		<Instruction code="48 8D 99 A0 00 00 00" comment="lea rbx, [rcx+0A0h]" />
		<Instruction code="BF 0F 00 00 00" comment="mov edi, MAX_LOBBY" />
		<Instruction code="48 8B 0B" comment="mov rcx, [rbx]" />
		
		<Notify inst_index="1" value="PatchLobbyA1RW1_A1R2A1R3" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyMapList1 -->
	<Patch name="PatchNumLobby1" type="notify" search_start="0x4163F0" comment="signature 1.24.1" >
		<Instruction code="FF C6" comment="inc esi" />
		<Instruction code="48 83 C3 10" comment="add rbx, 10h" />
		<Instruction code="48 83 C7 08" comment="add rdi, 8" />
		<Instruction code="83 FE 0F" comment="cmp esi, MAX_LOBBY" />
		
		<Notify inst_index="3" inst_offset="2" value="PatchNumLobbies" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyMapList2  (lobby_m1_a1) -->
	<Patch name="PatchNumLobby2" type="notify" search_start="0x416815" comment="signature 1.24.1" >
		<Instruction code="D1 C7" comment="rol edi, 1" />
		<Instruction code="49 FF C6" comment="inc r14" />
		<Instruction code="8B 44 24 34" comment="mov eax, [rsp+34h]" />
		<Instruction code="83 F8 0F" comment="cmp eax, MAX_LOBBY" />
		
		<Notify inst_index="3" inst_offset="2" value="PatchNumLobbies" />
	</Patch>
	
	<!-- Patch in same function than the above one -->
	<Patch name="PatchNumLobby3" type="notify" search_start="0x416963" comment="signature 1.24.1" >
		<Instruction code="83 FB 0F" comment="cmp ebx, MAX_LOBBY" />
		<Instruction code="72 A8" comment="jb loop" />
		<Instruction code="49 8B 8D 48 02 00 00" comment="mov rcx, [r13+248h]" />
		
		<Notify inst_index="0" inst_offset="2" value="PatchNumLobbies" />
	</Patch>
	
	<!-- Patch in same function than the above one -->
	<!-- This thing is probably creating a std::vector of something with MAX_LOBBY+1 size -->
	<Patch name="PatchNumLobby4" type="notify" search_start="0x4168C7" comment="signature 1.24.1" >
		<Instruction code="BA 10 00 00 00" comment="mov edx, MAX_LOBBY+1" />
		<Instruction code="48 8B C8" comment="mov rcx, rax" />
		<Instruction code="E8 XXXXXXXX" comment="call XXXXXXXX" />
		<Instruction code="EB 03" comment="jmp 03" />
		
		<Notify inst_index="0" inst_offset="1" value="PatchNumLobbiesP1" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyMapList4 -->
	<Patch name="PatchNumLobby5" type="notify" search_start="0x4176A0" comment="signature 1.24.1" >
		<Instruction code="83 FA 0F" comment="cmp edx, MAX_LOBBY" />
		<Instruction code="72 2A" comment="jb 2A" />
		
		<Notify inst_index="0" inst_offset="2" value="PatchNumLobbies" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyInteger -->
	<Patch name="PatchNumLobby6" type="notify" search_start="0x414B80" comment="signature 1.24.1" >
		<Instruction code="8D 42 FF" comment="lea eax, [rdx-1]" />
		<Instruction code="83 F8 0E" comment="cmp eax, MAX_LOBBY-1" />
		<Instruction code="77 11" comment="ja 11" />
		
		<Notify inst_index="1" inst_offset="2" value="PatchNumLobbiesM1" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyM1A4 -->
	<Patch name="PatchNumLobby7" type="notify" search_start="0x414DB6" comment="signature 1.24.1" >
		<Instruction code="FF C6" comment="inc esi" />
		<Instruction code="48 83 C3 10" comment="add rbx, 10h" />
		<Instruction code="83 FE 10" comment="cmp esi, MAX_LOBBY+1" />
		
		<Notify inst_index="2" inst_offset="2" value="PatchNumLobbiesP1" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyM1A6 -->
	<Patch name="PatchNumLobby8" type="notify" search_start="0x416D12" comment="signature 1.24.1" >
		<Instruction code="FF C7" comment="inc edi" />
		<Instruction code="48 83 C3 10" comment="add rbx, 10h" />
		<Instruction code="83 FF 10" comment="cmp edi, MAX_LOBBY+1" />
		<Instruction code="72 DA" comment="jb loop" />
		<Instruction code="85 ED" comment="test ebp, ebp" />
		
		<Notify inst_index="2" inst_offset="2" value="PatchNumLobbiesP1" />
	</Patch>
	
	<!-- Patch in same function as above -->
	<Patch name="PatchNumLobby9" type="notify" search_start="0x416D7F" comment="signature 1.24.1" >
		<Instruction code="4C 89 33" comment="mov [rbx], r14" />
		<Instruction code="FF C7" comment="inc edi" />
		<Instruction code="48 83 C3 10" comment="add rbx, 10h" />
		<Instruction code="83 FF 0F" comment="cmp edi, MAX_LOBBY" />
		
		<Notify inst_index="3" inst_offset="2" value="PatchNumLobbies" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyM1A9 -->
	<Patch name="PatchNumLobby10" type="notify" search_start="0x416B51" comment="signature 1.24.1" >
		<Instruction code="83 FF 10" comment="cmp edi, MAX_LOBBY+1" />
		<Instruction code="72 DA" comment="jb loop" />
		<Instruction code="8B FD" comment="mov edi, ebp" />
		
		<Notify inst_index="0" inst_offset="2" value="PatchNumLobbiesP1" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyM2A3 -->
	<Patch name="PatchNumLobby12" type="notify" search_start="0x414E16" comment="signature 1.24.1" >
		<Instruction code="FF C7" comment="inc edi" />
		<Instruction code="48 83 C3 10" comment="add rbx, 10h" />
		<Instruction code="83 FF 0F" comment="cmp edi, MAX_LOBBY" />
		<Instruction code="72 E3" comment="jb loop" />
		
		<Notify inst_index="2" inst_offset="2" value="PatchNumLobbies" />
	</Patch>
	
	<!-- Patch in same function than PatchLobbyM2A5 -->
	<Patch name="PatchNumLobby13" type="notify" search_start="0x416BAB" comment="signature 1.24.1" >
		<Instruction code="FF C7" comment="inc edi" />
		<Instruction code="48 83 C3 10" comment="add rbx, 10h" />
		<Instruction code="83 FF 0F" comment="cmp esi, MAX_LOBBY" />
		<Instruction code="72 DA" comment="jb loop" />
		<Instruction code="48 8D 8E 30 03 00 00" comment="lea rcx, [rsi+330h]" />
		
		<Notify inst_index="2" inst_offset="2" value="PatchNumLobbies" />
	</Patch>
	
	<Patch name="PatchNumLobby15" type="notify" search_start="0x414BD7" comment="signature 1.24.1" >
		<Instruction code="83 FA 10" comment="cmp edx, MAX_LOBBY+1" />
		<Instruction code="7F 11" comment="jg 11" />
		<Instruction code="83 FA FF" comment="cmp edx, -1" />
		
		<Notify inst_index="0" inst_offset="2" value="PatchNumLobbiesP1" />
	</Patch>
	
	<!-- lobbymap_called_by_ctor. Same function as PatchLobbyA1RW1 -->
	<Patch name="PatchNumLobby16" type="notify" search_start="0x3F3206" comment="signature 1.24.1" >
		<Instruction code="BE 10 00 00 00" comment="mov esi, MAX_LOBBY+1" />
		<Instruction code="48 8D 99 A0 00 00 00" comment="lea rbx, [rcx+0A0h]" />
		<Instruction code="8D 6E FF" comment="lea ebp, [rsi-1]" />
		
		<Notify inst_index="0" inst_offset="1" value="PatchNumLobbiesP1" />
	</Patch>
	
	<!-- lobbymap_a1r2. Same function as PatchLobby_A1R2A1R3 -->
	<Patch name="PatchNumLobby17" type="notify" search_start="0x3F6BD6" comment="signature 1.24.1" >
		<Instruction code="48 83 EC 20" comment="sub rsp, 20h" />
		<Instruction code="48 8D 99 A0 00 00 00" comment="lea rbx, [rcx+0A0h]" />
		<Instruction code="BF 0F 00 00 00" comment="mov edi, MAX_LOBBY" />
		<Instruction code="48 8B 0B" comment="mov rcx, [rbx]" />
		
		<Notify inst_index="2" inst_offset="1" value="PatchNumLobbies" />
	</Patch>	
	
	<!-- And a looooot more of patches would go here -->
</EternityPatchFile>